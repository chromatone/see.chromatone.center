(function(g,y){typeof exports=="object"&&typeof module!="undefined"?y(exports):typeof define=="function"&&define.amd?define(["exports"],y):(g=typeof globalThis!="undefined"?globalThis:g||self,y(g["gun-avatar"]={}))})(this,function(g){"use strict";(()=>{if(!a())return;const i=CanvasRenderingContext2D.prototype,t=i.drawImage;if(!t){console.error("This script requires a basic implementation of drawImage");return}i.drawImage=function(n,d,l){if(!(arguments.length===9))return t.apply(this,[...arguments]);const f=s(...arguments);if(!o(f))return t.apply(this,f)};function a(){const e=document.createElement("canvas").getContext("2d");e.fillRect(0,0,40,40),e.drawImage(e.canvas,-40,-40,80,80,50,50,20,20);const n=e.getImageData(50,50,30,30),d=new Uint32Array(n.data.buffer),l=(c,m)=>d[m*n.width+c],u=[[9,9],[20,9],[9,20],[20,20]],f=[[10,10],[19,10],[10,19],[19,19]];return u.some(([c,m])=>l(c,m)!==0)||f.some(([c,m])=>l(c,m)===0)}function s(e,n,d,l,u,f,c,m,p){const{width:v,height:M}=r(e);l<0&&(n+=l,l=Math.abs(l)),u<0&&(d+=u,u=Math.abs(u)),m<0&&(f+=m,m=Math.abs(m)),p<0&&(c+=p,p=Math.abs(p));const E=Math.max(n,0),A=Math.min(n+l,v),b=Math.max(d,0),$=Math.min(d+u,M),R=m/l,T=p/u;return[e,E,b,A-E,$-b,n<0?f-n*R:f,d<0?c-d*T:c,(A-E)*R,($-b)*T]}function o(e){return[3,4,7,8].some(n=>!e[n])}function r(e){const n=d=>{const l=globalThis[d];return l&&e instanceof l};if(n("HTMLImageElement"))return{width:e.naturalWidth,height:e.naturalHeight};if(n("HTMLVideoElement"))return{width:e.videoWidth,height:e.videoHeight};if(n("SVGImageElement"))throw new TypeError("SVGImageElement isn't yet supported as source image.","UnsupportedError");if(n("HTMLCanvasElement")||n("ImageBitmap"))return e}})();function y(i="gun-avatar"){document.addEventListener("DOMContentLoaded",()=>{let t=document.getElementsByClassName(i);for(let a of t)a.dataset.round!="false"&&(a.style.borderRadius="100%"),a.src=C({pub:a.dataset.pub,size:a.dataset.size,dark:a.dataset.dark,draw:a.dataset.draw,reflect:a.dataset.reflect!="false"})})}function L(i="gun-avatar"){let t=!1;if(!document||t)return;class a extends HTMLElement{constructor(){super();this.attachShadow({mode:"open"}),this.img=document.createElement("img"),this.shadowRoot.append(this.img)}render(){this.pub=this.hasAttribute("pub")?this.getAttribute("pub"):"1234123455Ute2tFhdjDQgzR-1234lfSlZxgEZKuquI.2F-j1234434U1234Asj-5lxnECG5TDyuPD8gEiuI123",this.size=this.hasAttribute("size")?this.getAttribute("size"):400,this.draw=this.hasAttribute("draw")?this.getAttribute("draw"):"circles",this.reflect=this.hasAttribute("reflect")?this.getAttribute("reflect")!="false":!0,this.round=!!(this.hasAttribute("round")||this.getAttribute("round")==""),this.round?this.img.style.borderRadius="100%":this.img.style.borderRadius="0%",this.dark=!!(this.hasAttribute("dark")||this.getAttribute("dark")==""),this.img.src=C({pub:this.pub,size:this.size,dark:this.dark,draw:this.draw,reflect:this.reflect})}connectedCallback(){this.render()}static get observedAttributes(){return["pub","round","size","dark","draw","reflect"]}attributeChangedCallback(o,r,e){this.render()}}customElements.define(i,a),t=!0}const h={};function C({pub:i,size:t=800,dark:a=!1,draw:s="circles",reflect:o=!0}={}){var u,f;if(!i)return;if((f=(u=h==null?void 0:h[s])==null?void 0:u[t])==null?void 0:f[i])return h[a?"dark":"light"][s][t][i];const r=document.createElement("canvas");r.width=r.height=t;const e=r.getContext("2d"),d=i.split(".").map(c=>P(c));D(e,d[0][42],d[1][42],t,a),s=="circles"&&(S(d[0],e,t,.42*t),e.globalCompositeOperation="multiply",S(d[1],e,t,.125*t)),s=="squares"&&(e.filter="blur(20px)",I(d[0],e,t),e.filter="blur(0px)",e.globalCompositeOperation="color-burn",I(d[1],e,t)),o&&(e.globalCompositeOperation="source-over",e.scale(-1,1),e.translate(-t/2,0),e.drawImage(r,t/2,0,t,t,0,0,t,t));let l=a?"dark":"light";return h[l]=h[l]||{},h[l][s]=h[l][s]||{},h[l][s][t]=h[l][s][t]||{},h[l][s][t][i]=r.toDataURL(),h[l][s][t][i]}function D(i,t,a,s,o=!1){var r=i.createLinearGradient(0,0,0,s);let e=70;o&&(e=0),r.addColorStop(0,`hsla(0,0%,${e+t*30}%)`),r.addColorStop(1,`hsla(0,0%,${e+a*30}%)`),i.fillStyle=r,i.fillRect(0,0,s,s)}function I(i,t,a){w(i,14).forEach(o=>{if(o.length==14){let r=o[0]*a,e=o[1]*a,n=a/8+o[2]*a*(7/8),d=o[13]*Math.PI,l=o[3]*360,u=o[4]*100,f=o[5]*100,c=o[6],m=o[7],p=o[8]*360,v=o[9]*100,M=o[10]*100,E=o[11],A=o[12];const b=t.createLinearGradient(r+n*m,0,r+n*A,a);b.addColorStop(0,`hsla(${l},${u}%,${f}%,${c})`),b.addColorStop(1,`hsla(${p},${v}%,${M}%,${E})`),t.fillStyle=b,t.translate(r,e),t.rotate(d),t.fillRect(-n/2,-n/2,n,n),t.setTransform(1,0,0,1,0,0)}})}function S(i,t,a,s){w(i,7).forEach(r=>{if(r.length==7){let e=a/2+r[0]*a/2,n=r[1]*a,d=r[2]*s,l=r[3]*360,u=r[4]*100,f=r[5]*100,c=r[6];t.beginPath(),t.arc(e,n,d,0,2*Math.PI,!1),t.fillStyle=`hsla(${l},${u}%,${f}%,${c})`,t.closePath(),t.fill()}})}function P(i){const a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split("");let s=[],o=0;for(let r of i)s[o++]=a.indexOf(r)/64;return s}function w(i,t=3){return[...Array(Math.ceil(i.length/t))].map(()=>i.splice(0,t))}g.gunAvatar=C,g.mountClass=y,g.mountElement=L,Object.defineProperty(g,"__esModule",{value:!0}),g[Symbol.toStringTag]="Module"});
